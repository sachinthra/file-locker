openapi: 3.0.0
info:
  title: File Locker API
  description: Secure file storage and streaming API with AES-256 encryption
  version: 1.0.0
  contact:
    name: File Locker API Support
    url: https://github.com/sachinthra/file-locker
servers:
  - url: http://localhost:9010/api/v1
    description: Local Development Server
  - url: http://localhost:9010/api/v1
    description: Production Server

security:
  - BearerAuth: []

paths:
  /auth/register:
    post:
      summary: Register a new user
      description: Creates a new user account with encrypted password storage
      tags:
        - Authentication
      security: [] # Public endpoint
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, password, email]
              properties:
                username:
                  type: string
                  minLength: 3
                  example: "john_doe"
                password:
                  type: string
                  minLength: 8
                  format: password
                  example: "SecurePass123!"
                email:
                  type: string
                  format: email
                  example: "john@example.com"
      responses:
        201:
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        400:
          description: Invalid request (username/password too short, invalid email)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        409:
          description: Username already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/login:
    post:
      summary: Login user
      description: Authenticates user and returns JWT token
      tags:
        - Authentication
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, password]
              properties:
                username:
                  type: string
                  example: "john_doe"
                password:
                  type: string
                  format: password
                  example: "SecurePass123!"
      responses:
        200:
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        401:
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/logout:
    post:
      summary: Logout user
      description: Invalidates the current JWT token
      tags:
        - Authentication
      responses:
        200:
          description: Logged out successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Logged out successfully"
        401:
          description: Unauthorized (invalid or missing token)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /auth/me:
    get:
      summary: Get current user info
      description: Returns authenticated user's profile information
      tags:
        - Authentication
      responses:
        200:
          description: User information retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserInfo'
        401:
          description: Unauthorized (missing, expired, or invalid token)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /announcements:
    get:
      summary: Get all announcements
      description: Returns all active announcements for the authenticated user
      tags:
        - Announcements
      responses:
        200:
          description: List of announcements
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Announcement'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /announcements/{id}/dismiss:
    post:
      summary: Dismiss an announcement
      description: Marks an announcement as dismissed for the current user
      tags:
        - Announcements
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Announcement ID to dismiss
          example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
      responses:
        200:
          description: Announcement dismissed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Announcement dismissed"
        400:
          description: Invalid announcement ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Announcement not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/announcements:
    get:
      summary: Get all announcements (admin)
      description: Returns all announcements including inactive ones. Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      responses:
        200:
          description: List of all announcements
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Announcement'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    
    post:
      summary: Create new announcement (admin)
      description: Creates a new announcement. Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title, message, severity]
              properties:
                title:
                  type: string
                  example: "System Maintenance"
                message:
                  type: string
                  example: "Scheduled maintenance window on Sunday"
                severity:
                  type: string
                  enum: [info, warning, error]
                  example: "warning"
      responses:
        201:
          description: Announcement created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Announcement'
        400:
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/announcements/{id}:
    delete:
      summary: Delete announcement (admin)
      description: Permanently deletes an announcement. Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Announcement ID to delete
          example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
      responses:
        200:
          description: Announcement deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Announcement deleted"
        400:
          description: Invalid announcement ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Announcement not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /upload:
    post:
      summary: Upload a file
      description: Uploads a file with automatic AES-256 encryption. Supports optional tags and auto-expiry.
      tags:
        - Files
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                  description: File to upload (max 500MB)
                tags:
                  type: string
                  description: Comma-separated tags (e.g., "work,document,2025")
                  example: "work,document"
                expire_after:
                  type: integer
                  description: Hours until file expires and is auto-deleted (0 = never)
                  example: 24
      responses:
        201:
          description: File uploaded and encrypted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileMetadata'
        400:
          description: Bad request (no file provided, file too large)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Unauthorized (missing or invalid token)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        413:
          description: File too large (exceeds 500MB limit)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /files:
    get:
      summary: List user files
      description: Returns all files owned by the authenticated user, sorted by creation date (newest first)
      tags:
        - Files
      responses:
        200:
          description: List of user files
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileListResponse'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        500:
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    
    delete:
      summary: Delete a file
      description: Permanently deletes a file from storage
      tags:
        - Files
      parameters:
        - in: query
          name: id
          required: true
          schema:
            type: string
          description: File ID to delete
          example: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
      responses:
        200:
          description: File deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "File deleted successfully"
                  file_id:
                    type: string
                    example: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
        400:
          description: File ID required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Access denied (not file owner)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /files/search:
    get:
      summary: Search user files
      description: Search files by filename or tags
      tags:
        - Files
      parameters:
        - in: query
          name: q
          required: true
          schema:
            type: string
          description: Search query (matches filename and tags)
          example: "document"
      responses:
        200:
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  files:
                    type: array
                    items:
                      $ref: '#/components/schemas/FileMetadata'
                  count:
                    type: integer
                    example: 3
                  query:
                    type: string
                    example: "document"
        400:
          description: Search query required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /download/{id}:
    get:
      summary: Download a file
      description: Downloads the decrypted file. File is automatically decrypted server-side.
      tags:
        - Files
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: File ID to download
          example: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
      responses:
        200:
          description: File stream (decrypted)
          headers:
            Content-Disposition:
              schema:
                type: string
              description: Attachment with original filename
              example: 'attachment; filename="document.pdf"'
            Content-Type:
              schema:
                type: string
              description: Original MIME type
              example: "application/pdf"
            Content-Length:
              schema:
                type: integer
              description: File size in bytes
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        400:
          description: File ID required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Access denied (not file owner)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        410:
          description: File has expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /stream/{id}:
    get:
      summary: Stream a video file
      description: |
        Stream encrypted video files with seeking support. 
        Supports HTTP Range requests for video player seeking.
        Files are decrypted on-the-fly using AES-CTR mode for efficient streaming.
      tags:
        - Files
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: File ID to stream
          example: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
        - in: query
          name: token
          schema:
            type: string
          description: JWT token for browser-based streaming (alternative to Authorization header)
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        - in: header
          name: Range
          schema:
            type: string
          description: HTTP Range header for seeking (e.g., "bytes=0-1023")
          example: "bytes=0-1023"
      responses:
        206:
          description: Partial content (Video chunk)
          headers:
            Content-Type:
              schema:
                type: string
              description: Original MIME type
              example: "video/mp4"
            Content-Range:
              schema:
                type: string
              description: Range of bytes returned
              example: "bytes 0-1023/2048576"
            Content-Length:
              schema:
                type: integer
              description: Length of this chunk
              example: 1024
            Accept-Ranges:
              schema:
                type: string
              description: Server supports byte ranges
              example: "bytes"
          content:
            video/*:
              schema:
                type: string
                format: binary
        200:
          description: Full file content (when no Range header provided)
          headers:
            Content-Type:
              schema:
                type: string
              example: "video/mp4"
            Accept-Ranges:
              schema:
                type: string
              example: "bytes"
          content:
            video/*:
              schema:
                type: string
                format: binary
        400:
          description: File ID required or invalid range
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        410:
          description: File has expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        416:
          description: Range not satisfiable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /user/password:
    patch:
      summary: Change user password
      description: Allows authenticated user to change their password
      tags:
        - User
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [old_password, new_password]
              properties:
                old_password:
                  type: string
                  format: password
                  example: "OldPass123!"
                new_password:
                  type: string
                  format: password
                  minLength: 8
                  example: "NewSecurePass456!"
      responses:
        200:
          description: Password changed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Password updated successfully"
        400:
          description: Invalid request (password too short)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Unauthorized or incorrect old password
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/tokens:
    post:
      summary: Create Personal Access Token
      description: Creates a new PAT for API authentication
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name]
              properties:
                name:
                  type: string
                  example: "CLI Tool Access"
                expires_at:
                  type: string
                  format: date-time
                  nullable: true
                  example: "2026-12-31T23:59:59Z"
      responses:
        201:
          description: Token created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    example: "fl_abc123xyz..."
                  token_id:
                    type: string
                    example: "uuid-here"
                  name:
                    type: string
                    example: "CLI Tool Access"
                  expires_at:
                    type: string
                    format: date-time
                    nullable: true
        400:
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    
    get:
      summary: List Personal Access Tokens
      description: Returns all PATs for the authenticated user
      tags:
        - Authentication
      responses:
        200:
          description: List of tokens
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                    name:
                      type: string
                    created_at:
                      type: string
                      format: date-time
                    expires_at:
                      type: string
                      format: date-time
                      nullable: true
                    last_used:
                      type: string
                      format: date-time
                      nullable: true
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/tokens/{id}:
    delete:
      summary: Revoke Personal Access Token
      description: Permanently revokes a PAT
      tags:
        - Authentication
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Token ID to revoke
      responses:
        200:
          description: Token revoked successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Token revoked"
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: Token not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /files/export:
    get:
      summary: Export all files
      description: Downloads all user files as a zip archive
      tags:
        - Files
      responses:
        200:
          description: Zip file containing all user files
          headers:
            Content-Disposition:
              schema:
                type: string
              example: 'attachment; filename="filelocker-export.zip"'
            Content-Type:
              schema:
                type: string
              example: "application/zip"
          content:
            application/zip:
              schema:
                type: string
                format: binary
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: No files to export
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /files/{fileID}:
    patch:
      summary: Update file metadata
      description: Updates file tags or other metadata
      tags:
        - Files
      parameters:
        - in: path
          name: fileID
          required: true
          schema:
            type: string
          description: File ID to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                tags:
                  type: array
                  items:
                    type: string
                  example: ["work", "updated"]
                file_name:
                  type: string
                  example: "renamed-document.pdf"
      responses:
        200:
          description: File updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileMetadata'
        400:
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Access denied (not file owner)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/stats:
    get:
      summary: Get system statistics
      description: Returns system-wide statistics. Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      responses:
        200:
          description: System statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_users:
                    type: integer
                  total_files:
                    type: integer
                  total_storage_bytes:
                    type: integer
                  active_sessions:
                    type: integer
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/users:
    get:
      summary: Get all users
      description: Returns list of all users with pagination. Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
        - in: query
          name: status
          schema:
            type: string
            enum: [active, inactive, pending]
      responses:
        200:
          description: List of users
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      $ref: '#/components/schemas/UserInfo'
                  total:
                    type: integer
                  page:
                    type: integer
                  limit:
                    type: integer
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/users/pending:
    get:
      summary: Get pending users count
      description: Returns count of users awaiting approval. Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      responses:
        200:
          description: Pending users count
          content:
            application/json:
              schema:
                type: object
                properties:
                  count:
                    type: integer
                    example: 5
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/users/{id}/approve:
    post:
      summary: Approve pending user
      description: Approves a user registration. Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        200:
          description: User approved
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User approved"
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/users/{id}/reject:
    post:
      summary: Reject pending user
      description: Rejects a user registration. Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        200:
          description: User rejected
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User rejected"
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/users/{id}:
    delete:
      summary: Delete user
      description: Permanently deletes a user and their files. Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        200:
          description: User deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User deleted"
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/users/{id}/status:
    patch:
      summary: Update user status
      description: Changes user account status (active/inactive). Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  type: string
                  enum: [active, inactive]
                  example: "active"
      responses:
        200:
          description: Status updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User status updated"
        400:
          description: Invalid status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/users/{id}/role:
    patch:
      summary: Update user role
      description: Changes user role (user/admin). Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [role]
              properties:
                role:
                  type: string
                  enum: [user, admin]
                  example: "admin"
      responses:
        200:
          description: Role updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User role updated"
        400:
          description: Invalid role
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/users/{id}/reset-password:
    post:
      summary: Reset user password
      description: Resets user password to a temporary one. Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        200:
          description: Password reset
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Password reset successfully"
                  temporary_password:
                    type: string
                    example: "TempPass123!"
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/users/{id}/logout:
    post:
      summary: Force user logout
      description: Invalidates all sessions for a user. Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        200:
          description: User logged out
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User logged out"
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/settings:
    get:
      summary: Get system settings
      description: Returns all system settings. Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      responses:
        200:
          description: System settings
          content:
            application/json:
              schema:
                type: object
                properties:
                  registration_mode:
                    type: string
                    enum: [open, approval_required, closed]
                  max_upload_size:
                    type: integer
                  default_file_expiry:
                    type: integer
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    
    patch:
      summary: Update system settings
      description: Updates system configuration. Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                key:
                  type: string
                  example: "registration_mode"
                value:
                  type: string
                  example: "approval_required"
      responses:
        200:
          description: Setting updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Setting updated"
        400:
          description: Invalid setting
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/files:
    get:
      summary: Get all files (admin view)
      description: Returns all files from all users. Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
      responses:
        200:
          description: List of all files
          content:
            application/json:
              schema:
                type: object
                properties:
                  files:
                    type: array
                    items:
                      $ref: '#/components/schemas/FileMetadata'
                  total:
                    type: integer
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/files/{id}:
    delete:
      summary: Delete any file (admin)
      description: Deletes any file regardless of owner. Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        200:
          description: File deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "File deleted"
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        404:
          description: File not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/storage/analyze:
    get:
      summary: Analyze storage usage
      description: Returns detailed storage analysis. Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      responses:
        200:
          description: Storage analysis
          content:
            application/json:
              schema:
                type: object
                properties:
                  total_files:
                    type: integer
                  total_size_bytes:
                    type: integer
                  orphaned_files:
                    type: integer
                  expired_files:
                    type: integer
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/storage/cleanup:
    post:
      summary: Cleanup storage
      description: Removes orphaned and expired files. Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      responses:
        200:
          description: Cleanup completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Storage cleanup completed"
                  files_deleted:
                    type: integer
                  space_freed_bytes:
                    type: integer
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/logs:
    get:
      summary: Get audit logs
      description: Returns system audit logs with pagination. Admin only.
      tags:
        - Admin
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 100
        - in: query
          name: action
          schema:
            type: string
          description: Filter by action type
        - in: query
          name: user_id
          schema:
            type: string
          description: Filter by user ID
      responses:
        200:
          description: Audit logs
          content:
            application/json:
              schema:
                type: object
                properties:
                  logs:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        user_id:
                          type: string
                        action:
                          type: string
                        details:
                          type: string
                        ip_address:
                          type: string
                        timestamp:
                          type: string
                          format: date-time
                  total:
                    type: integer
        401:
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        403:
          description: Forbidden (admin access required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from /auth/login or /auth/register
  
  schemas:
    AuthResponse:
      type: object
      required:
        - token
        - user_id
      properties:
        token:
          type: string
          description: JWT authentication token
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        user_id:
          type: string
          description: Unique user identifier
          example: "550e8400-e29b-41d4-a716-446655440000"
        email:
          type: string
          format: email
          description: User's email address
          example: "user@example.com"
    
    FileMetadata:
      type: object
      required:
        - file_id
        - file_name
        - size
        - mime_type
        - created_at
        - download_count
      properties:
        file_id:
          type: string
          description: Unique file identifier
          example: "f47ac10b-58cc-4372-a567-0e02b2c3d479"
        file_name:
          type: string
          description: Original filename
          example: "document.pdf"
        size:
          type: integer
          format: int64
          description: File size in bytes
          example: 2048576
        mime_type:
          type: string
          description: MIME type of the file
          example: "application/pdf"
        created_at:
          type: string
          format: date-time
          description: File upload timestamp
          example: "2025-12-28T10:30:00Z"
        expires_at:
          type: string
          format: date-time
          nullable: true
          description: Expiration timestamp (null if no expiration)
          example: "2025-12-29T10:30:00Z"
        tags:
          type: array
          items:
            type: string
          description: User-defined tags for categorization
          example: ["document", "important"]
        download_count:
          type: integer
          description: Number of times file has been downloaded
          example: 5
    
    ErrorResponse:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: Error message
          example: "Invalid credentials"
    
    FileListResponse:
      type: object
      required:
        - files
        - count
      properties:
        files:
          type: array
          items:
            $ref: '#/components/schemas/FileMetadata'
        count:
          type: integer
          description: Total number of files
          example: 10
    
    UserInfo:
      type: object
      required:
        - id
        - username
        - email
        - role
        - created_at
      properties:
        id:
          type: string
          description: Unique user identifier
          example: "550e8400-e29b-41d4-a716-446655440000"
        username:
          type: string
          description: Username
          example: "john_doe"
        email:
          type: string
          format: email
          description: User's email address
          example: "john@example.com"
        role:
          type: string
          enum: [user, admin]
          description: User role
          example: "user"
        created_at:
          type: string
          format: date-time
          description: Account creation timestamp
          example: "2025-01-01T10:00:00Z"
    
    Announcement:
      type: object
      required:
        - id
        - title
        - message
        - severity
        - created_at
      properties:
        id:
          type: string
          description: Unique announcement identifier
          example: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
        title:
          type: string
          description: Announcement title
          example: "System Maintenance"
        message:
          type: string
          description: Announcement message/body
          example: "Scheduled maintenance window on Sunday from 2AM-4AM EST"
        severity:
          type: string
          enum: [info, warning, error]
          description: Severity level of the announcement
          example: "warning"
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2025-12-28T10:00:00Z"
        dismissed:
          type: boolean
          description: Whether current user has dismissed this announcement
          example: false
