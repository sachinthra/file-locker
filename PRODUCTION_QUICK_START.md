# ğŸš€ Quick Reference - Production Distribution

## For Developers (Build & Release)

```bash
# Set your Docker Hub username
export DOCKER_USERNAME="yourusername"

# Build everything (Docker images + CLI binaries + .deb structure)
./scripts/build-release.sh

# Optional: Create .deb package
dpkg-deb --build dist/deb dist/filelocker-1.0.0.deb
```

**What gets built:**
- Docker images: `yourusername/filelocker-backend:latest` and `filelocker-frontend:latest`
- CLI binaries: `bin/fl-{darwin,linux,windows}-{amd64,arm64}`
- Debian package structure: `dist/deb/`

---

## For Server Admins (Installation)

### Quick Install (Debian/Ubuntu/Raspberry Pi)

```bash
# Extract installation files
tar -xzf filelocker-server-1.0.0.tar.gz
cd opt/filelocker

# Run interactive setup
./setup.sh

# Choose:
# - Web port (default: 8080)
# - Auto-generates secure passwords
# - Optionally starts services immediately
```

### Manual Start/Stop

```bash
cd /path/to/filelocker

# Start
docker compose -f docker-compose.yml up -d

# Stop
docker compose -f docker-compose.yml down

# View logs
docker compose -f docker-compose.yml logs -f

# Check status
docker compose -f docker-compose.yml ps
```

---

## For End Users (CLI)

### Install CLI

**Mac (M1/M2/M3):**
```bash
curl -LO https://github.com/user/filelocker/releases/latest/download/fl-darwin-arm64
chmod +x fl-darwin-arm64 && sudo mv fl-darwin-arm64 /usr/local/bin/fl
```

**Windows:**
Download `fl-windows-amd64.exe`, rename to `fl.exe`, add to PATH

### Use CLI

```bash
# First-time login
fl login --host http://your-server:8080 -u admin -p password123

# Upload file
fl upload document.pdf

# List files
fl ls

# Download file
fl download <file-id> -o downloaded.pdf
```

---

## Key Features

âœ… **Auto-Migrations**: Database migrations run automatically on backend startup  
âœ… **Smart CLI**: Auto-appends `/api` to host URL  
âœ… **Secure**: Only frontend port exposed  
âœ… **Embedded**: No external SQL files needed  
âœ… **Cross-Platform**: Binaries for Mac/Windows/Linux  
âœ… **ARM64**: Full Raspberry Pi support  

---

## File Structure

```
install/
â”œâ”€â”€ docker-compose.yml  # Production compose (pre-built images)
â””â”€â”€ setup.sh            # Interactive setup script

backend/
â”œâ”€â”€ migrations/         # SQL migrations (embedded in binary)
â”‚   â”œâ”€â”€ 000001_init.up.sql
â”‚   â”œâ”€â”€ 000001_init.down.sql
â”‚   â”œâ”€â”€ 000002_add_admin.up.sql
â”‚   â””â”€â”€ 000002_add_admin.down.sql
â”œâ”€â”€ internal/
â”‚   â””â”€â”€ db/
â”‚       â””â”€â”€ migrate.go  # Auto-migration logic
â””â”€â”€ cmd/
    â”œâ”€â”€ server/main.go  # Runs migrations on startup
    â””â”€â”€ cli/main.go     # Smart host configuration

scripts/
â””â”€â”€ build-release.sh    # Build everything

dist/                   # Generated by build-release.sh
â”œâ”€â”€ deb/                # Debian package structure
â””â”€â”€ filelocker-*.tar.gz # Release archives
```

---

## Architecture

```
Client CLI â†’ Frontend (Port 8080) â†’ Backend (Internal) â†’ PostgreSQL/MinIO/Redis
```

- Frontend: Nginx serving Preact SPA + API proxy
- Backend: Only accessible via Nginx `/api` proxy
- Database: Migrations embedded in backend binary
- CLI: Connects to frontend, not backend directly

---

## Default Credentials

**Username:** `admin`  
**Password:** `password123`  
âš ï¸ **CHANGE IMMEDIATELY AFTER FIRST LOGIN!**

---

## Troubleshooting

```bash
# Backend won't start
docker logs filelocker-server | grep migration

# CLI can't connect
curl http://your-server:8080/health  # Should return: healthy

# Reset everything (WARNING: Deletes all data!)
docker compose down -v
docker compose up -d
```

---

## Resources

- Full Guide: [Docs/PRODUCTION_DISTRIBUTION.md](./PRODUCTION_DISTRIBUTION.md)
- Raspberry Pi: [Docs/RASPBERRY_PI_DEPLOYMENT.md](./RASPBERRY_PI_DEPLOYMENT.md)
- Architecture: [Docs/ARCHITECTURE.md](./ARCHITECTURE.md)
